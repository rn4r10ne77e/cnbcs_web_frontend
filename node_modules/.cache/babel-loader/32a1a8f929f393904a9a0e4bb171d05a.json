{"ast":null,"code":"/**\n * @module ol/renderer/canvas/Layer\n */\nimport { equals } from '../../array.js';\nimport { asArray } from '../../color.js';\nimport { createCanvasContext2D } from '../../dom.js';\nimport { getBottomLeft, getBottomRight, getHeight, getTopLeft, getTopRight, getWidth } from '../../extent.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport ZIndexContext from '../../render/canvas/ZIndexContext.js';\nimport { apply as applyTransform, compose as composeTransform, create as createTransform, equivalent, makeInverse, toString as toTransformString } from '../../transform.js';\nimport LayerRenderer from '../Layer.js';\n\n/**\n * @type {Array<HTMLCanvasElement>}\n */\nexport const canvasPool = [];\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet pixelContext = null;\nfunction createPixelContext() {\n  pixelContext = createCanvasContext2D(1, 1, undefined, {\n    willReadFrequently: true\n  });\n}\n\n/**\n * @abstract\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nclass CanvasLayerRenderer extends LayerRenderer {\n  /**\n   * @param {LayerType} layer Layer.\n   */\n  constructor(layer) {\n    super(layer);\n\n    /**\n     * @protected\n     * @type {HTMLElement}\n     */\n    this.container = null;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.renderedResolution;\n\n    /**\n     * A temporary transform.  The values in this transform should only be used in a\n     * function that sets the values.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.tempTransform = createTransform();\n\n    /**\n     * The transform for rendered pixels to viewport CSS pixels.  This transform must\n     * be set when rendering a frame and may be used by other functions after rendering.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.pixelTransform = createTransform();\n\n    /**\n     * The transform for viewport CSS pixels to rendered pixels.  This transform must\n     * be set when rendering a frame and may be used by other functions after rendering.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.inversePixelTransform = createTransform();\n\n    /**\n     * @type {CanvasRenderingContext2D}\n     */\n    this.context = null;\n\n    /**\n     * @private\n     * @type {ZIndexContext}\n     */\n    this.deferredContext_ = null;\n\n    /**\n     * @type {boolean}\n     */\n    this.containerReused = false;\n\n    /**\n     * @protected\n     * @type {import(\"../../Map.js\").FrameState|null}\n     */\n    this.frameState = null;\n  }\n\n  /**\n   * @param {import('../../DataTile.js').ImageLike} image Image.\n   * @param {number} col The column index.\n   * @param {number} row The row index.\n   * @return {Uint8ClampedArray|null} The image data.\n   */\n  getImageData(image, col, row) {\n    if (!pixelContext) {\n      createPixelContext();\n    }\n    pixelContext.clearRect(0, 0, 1, 1);\n    let data;\n    try {\n      pixelContext.drawImage(image, col, row, 1, 1, 0, 0, 1, 1);\n      data = pixelContext.getImageData(0, 0, 1, 1).data;\n    } catch {\n      pixelContext = null;\n      return null;\n    }\n    return data;\n  }\n\n  /**\n   * @param {import('../../Map.js').FrameState} frameState Frame state.\n   * @return {string} Background color.\n   */\n  getBackground(frameState) {\n    const layer = this.getLayer();\n    let background = layer.getBackground();\n    if (typeof background === 'function') {\n      background = background(frameState.viewState.resolution);\n    }\n    return background || undefined;\n  }\n\n  /**\n   * Get a rendering container from an existing target, if compatible.\n   * @param {HTMLElement} target Potential render target.\n   * @param {string} transform CSS transform matrix.\n   * @param {string} [backgroundColor] Background color.\n   */\n  useContainer(target, transform, backgroundColor) {\n    const layerClassName = this.getLayer().getClassName();\n    let container, context;\n    if (target && target.className === layerClassName && (!backgroundColor || target && target.style.backgroundColor && equals(asArray(target.style.backgroundColor), asArray(backgroundColor)))) {\n      const canvas = target.firstElementChild;\n      if (canvas instanceof HTMLCanvasElement) {\n        context = canvas.getContext('2d');\n      }\n    }\n    if (context && equivalent(context.canvas.style.transform, transform)) {\n      // Container of the previous layer renderer can be used.\n      this.container = target;\n      this.context = context;\n      this.containerReused = true;\n    } else if (this.containerReused) {\n      // Previously reused container cannot be used any more.\n      this.container = null;\n      this.context = null;\n      this.containerReused = false;\n    } else if (this.container) {\n      this.container.style.backgroundColor = null;\n    }\n    if (!this.container) {\n      container = document.createElement('div');\n      container.className = layerClassName;\n      let style = container.style;\n      style.position = 'absolute';\n      style.width = '100%';\n      style.height = '100%';\n      context = createCanvasContext2D();\n      const canvas = context.canvas;\n      container.appendChild(canvas);\n      style = canvas.style;\n      style.position = 'absolute';\n      style.left = '0';\n      style.transformOrigin = 'top left';\n      this.container = container;\n      this.context = context;\n    }\n    if (!this.containerReused && backgroundColor && !this.container.style.backgroundColor) {\n      this.container.style.backgroundColor = backgroundColor;\n    }\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../../extent.js\").Extent} extent Clip extent.\n   * @protected\n   */\n  clipUnrotated(context, frameState, extent) {\n    const topLeft = getTopLeft(extent);\n    const topRight = getTopRight(extent);\n    const bottomRight = getBottomRight(extent);\n    const bottomLeft = getBottomLeft(extent);\n    applyTransform(frameState.coordinateToPixelTransform, topLeft);\n    applyTransform(frameState.coordinateToPixelTransform, topRight);\n    applyTransform(frameState.coordinateToPixelTransform, bottomRight);\n    applyTransform(frameState.coordinateToPixelTransform, bottomLeft);\n    const inverted = this.inversePixelTransform;\n    applyTransform(inverted, topLeft);\n    applyTransform(inverted, topRight);\n    applyTransform(inverted, bottomRight);\n    applyTransform(inverted, bottomLeft);\n    context.save();\n    context.beginPath();\n    context.moveTo(Math.round(topLeft[0]), Math.round(topLeft[1]));\n    context.lineTo(Math.round(topRight[0]), Math.round(topRight[1]));\n    context.lineTo(Math.round(bottomRight[0]), Math.round(bottomRight[1]));\n    context.lineTo(Math.round(bottomLeft[0]), Math.round(bottomLeft[1]));\n    context.clip();\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @protected\n   */\n  prepareContainer(frameState, target) {\n    const extent = frameState.extent;\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    const pixelRatio = frameState.pixelRatio;\n    const width = Math.round(getWidth(extent) / resolution * pixelRatio);\n    const height = Math.round(getHeight(extent) / resolution * pixelRatio);\n    // set forward and inverse pixel transforms\n    composeTransform(this.pixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / pixelRatio, 1 / pixelRatio, rotation, -width / 2, -height / 2);\n    makeInverse(this.inversePixelTransform, this.pixelTransform);\n    const canvasTransform = toTransformString(this.pixelTransform);\n    this.useContainer(target, canvasTransform, this.getBackground(frameState));\n    if (!this.containerReused) {\n      const canvas = this.context.canvas;\n      if (canvas.width != width || canvas.height != height) {\n        canvas.width = width;\n        canvas.height = height;\n      } else {\n        this.context.clearRect(0, 0, width, height);\n      }\n      if (canvasTransform !== canvas.style.transform) {\n        canvas.style.transform = canvasTransform;\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../../render/EventType.js\").default} type Event type.\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  dispatchRenderEvent_(type, context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(type)) {\n      const event = new RenderEvent(type, this.inversePixelTransform, frameState, context);\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  preRender(context, frameState) {\n    this.frameState = frameState;\n    if (frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  postRender(context, frameState) {\n    if (frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeferredInternal(frameState) {}\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {import('../../render/canvas/ZIndexContext.js').ZIndexContextProxy} Context.\n   */\n  getRenderContext(frameState) {\n    if (frameState.declutter && !this.deferredContext_) {\n      this.deferredContext_ = new ZIndexContext();\n    }\n    return frameState.declutter ? this.deferredContext_.getContext() : this.context;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  renderDeferred(frameState) {\n    if (!frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(RenderEventType.PRERENDER, this.context, frameState);\n    if (frameState.declutter && this.deferredContext_) {\n      this.deferredContext_.draw(this.context);\n      this.deferredContext_.clear();\n    }\n    this.renderDeferredInternal(frameState);\n    this.dispatchRenderEvent_(RenderEventType.POSTRENDER, this.context, frameState);\n  }\n\n  /**\n   * Creates a transform for rendering to an element that will be rotated after rendering.\n   * @param {import(\"../../coordinate.js\").Coordinate} center Center.\n   * @param {number} resolution Resolution.\n   * @param {number} rotation Rotation.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {number} width Width of the rendered element (in pixels).\n   * @param {number} height Height of the rendered element (in pixels).\n   * @param {number} offsetX Offset on the x-axis in view coordinates.\n   * @protected\n   * @return {!import(\"../../transform.js\").Transform} Transform.\n   */\n  getRenderTransform(center, resolution, rotation, pixelRatio, width, height, offsetX) {\n    const dx1 = width / 2;\n    const dy1 = height / 2;\n    const sx = pixelRatio / resolution;\n    const sy = -sx;\n    const dx2 = -center[0] + offsetX;\n    const dy2 = -center[1];\n    return composeTransform(this.tempTransform, dx1, dy1, sx, sy, -rotation, dx2, dy2);\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    delete this.frameState;\n    super.disposeInternal();\n  }\n}\nexport default CanvasLayerRenderer;","map":{"version":3,"names":["equals","asArray","createCanvasContext2D","getBottomLeft","getBottomRight","getHeight","getTopLeft","getTopRight","getWidth","RenderEvent","RenderEventType","ZIndexContext","apply","applyTransform","compose","composeTransform","create","createTransform","equivalent","makeInverse","toString","toTransformString","LayerRenderer","canvasPool","pixelContext","createPixelContext","undefined","willReadFrequently","CanvasLayerRenderer","constructor","layer","container","renderedResolution","tempTransform","pixelTransform","inversePixelTransform","context","deferredContext_","containerReused","frameState","getImageData","image","col","row","clearRect","data","drawImage","getBackground","getLayer","background","viewState","resolution","useContainer","target","transform","backgroundColor","layerClassName","getClassName","className","style","canvas","firstElementChild","HTMLCanvasElement","getContext","document","createElement","position","width","height","appendChild","left","transformOrigin","clipUnrotated","extent","topLeft","topRight","bottomRight","bottomLeft","coordinateToPixelTransform","inverted","save","beginPath","moveTo","Math","round","lineTo","clip","prepareContainer","rotation","pixelRatio","size","canvasTransform","dispatchRenderEvent_","type","hasListener","event","dispatchEvent","preRender","declutter","PRERENDER","postRender","POSTRENDER","renderDeferredInternal","getRenderContext","renderDeferred","draw","clear","getRenderTransform","center","offsetX","dx1","dy1","sx","sy","dx2","dy2","disposeInternal"],"sources":["C:/prj/cnbcs_web_frontend/node_modules/ol/renderer/canvas/Layer.js"],"sourcesContent":["/**\n * @module ol/renderer/canvas/Layer\n */\nimport {equals} from '../../array.js';\nimport {asArray} from '../../color.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {\n  getBottomLeft,\n  getBottomRight,\n  getHeight,\n  getTopLeft,\n  getTopRight,\n  getWidth,\n} from '../../extent.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport ZIndexContext from '../../render/canvas/ZIndexContext.js';\nimport {\n  apply as applyTransform,\n  compose as composeTransform,\n  create as createTransform,\n  equivalent,\n  makeInverse,\n  toString as toTransformString,\n} from '../../transform.js';\nimport LayerRenderer from '../Layer.js';\n\n/**\n * @type {Array<HTMLCanvasElement>}\n */\nexport const canvasPool = [];\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet pixelContext = null;\n\nfunction createPixelContext() {\n  pixelContext = createCanvasContext2D(1, 1, undefined, {\n    willReadFrequently: true,\n  });\n}\n\n/**\n * @abstract\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nclass CanvasLayerRenderer extends LayerRenderer {\n  /**\n   * @param {LayerType} layer Layer.\n   */\n  constructor(layer) {\n    super(layer);\n\n    /**\n     * @protected\n     * @type {HTMLElement}\n     */\n    this.container = null;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.renderedResolution;\n\n    /**\n     * A temporary transform.  The values in this transform should only be used in a\n     * function that sets the values.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.tempTransform = createTransform();\n\n    /**\n     * The transform for rendered pixels to viewport CSS pixels.  This transform must\n     * be set when rendering a frame and may be used by other functions after rendering.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.pixelTransform = createTransform();\n\n    /**\n     * The transform for viewport CSS pixels to rendered pixels.  This transform must\n     * be set when rendering a frame and may be used by other functions after rendering.\n     * @protected\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.inversePixelTransform = createTransform();\n\n    /**\n     * @type {CanvasRenderingContext2D}\n     */\n    this.context = null;\n\n    /**\n     * @private\n     * @type {ZIndexContext}\n     */\n    this.deferredContext_ = null;\n\n    /**\n     * @type {boolean}\n     */\n    this.containerReused = false;\n\n    /**\n     * @protected\n     * @type {import(\"../../Map.js\").FrameState|null}\n     */\n    this.frameState = null;\n  }\n\n  /**\n   * @param {import('../../DataTile.js').ImageLike} image Image.\n   * @param {number} col The column index.\n   * @param {number} row The row index.\n   * @return {Uint8ClampedArray|null} The image data.\n   */\n  getImageData(image, col, row) {\n    if (!pixelContext) {\n      createPixelContext();\n    }\n    pixelContext.clearRect(0, 0, 1, 1);\n\n    let data;\n    try {\n      pixelContext.drawImage(image, col, row, 1, 1, 0, 0, 1, 1);\n      data = pixelContext.getImageData(0, 0, 1, 1).data;\n    } catch {\n      pixelContext = null;\n      return null;\n    }\n    return data;\n  }\n\n  /**\n   * @param {import('../../Map.js').FrameState} frameState Frame state.\n   * @return {string} Background color.\n   */\n  getBackground(frameState) {\n    const layer = this.getLayer();\n    let background = layer.getBackground();\n    if (typeof background === 'function') {\n      background = background(frameState.viewState.resolution);\n    }\n    return background || undefined;\n  }\n\n  /**\n   * Get a rendering container from an existing target, if compatible.\n   * @param {HTMLElement} target Potential render target.\n   * @param {string} transform CSS transform matrix.\n   * @param {string} [backgroundColor] Background color.\n   */\n  useContainer(target, transform, backgroundColor) {\n    const layerClassName = this.getLayer().getClassName();\n    let container, context;\n    if (\n      target &&\n      target.className === layerClassName &&\n      (!backgroundColor ||\n        (target &&\n          target.style.backgroundColor &&\n          equals(\n            asArray(target.style.backgroundColor),\n            asArray(backgroundColor),\n          )))\n    ) {\n      const canvas = target.firstElementChild;\n      if (canvas instanceof HTMLCanvasElement) {\n        context = canvas.getContext('2d');\n      }\n    }\n    if (context && equivalent(context.canvas.style.transform, transform)) {\n      // Container of the previous layer renderer can be used.\n      this.container = target;\n      this.context = context;\n      this.containerReused = true;\n    } else if (this.containerReused) {\n      // Previously reused container cannot be used any more.\n      this.container = null;\n      this.context = null;\n      this.containerReused = false;\n    } else if (this.container) {\n      this.container.style.backgroundColor = null;\n    }\n    if (!this.container) {\n      container = document.createElement('div');\n      container.className = layerClassName;\n      let style = container.style;\n      style.position = 'absolute';\n      style.width = '100%';\n      style.height = '100%';\n      context = createCanvasContext2D();\n      const canvas = context.canvas;\n      container.appendChild(canvas);\n      style = canvas.style;\n      style.position = 'absolute';\n      style.left = '0';\n      style.transformOrigin = 'top left';\n      this.container = container;\n      this.context = context;\n    }\n    if (\n      !this.containerReused &&\n      backgroundColor &&\n      !this.container.style.backgroundColor\n    ) {\n      this.container.style.backgroundColor = backgroundColor;\n    }\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../../extent.js\").Extent} extent Clip extent.\n   * @protected\n   */\n  clipUnrotated(context, frameState, extent) {\n    const topLeft = getTopLeft(extent);\n    const topRight = getTopRight(extent);\n    const bottomRight = getBottomRight(extent);\n    const bottomLeft = getBottomLeft(extent);\n\n    applyTransform(frameState.coordinateToPixelTransform, topLeft);\n    applyTransform(frameState.coordinateToPixelTransform, topRight);\n    applyTransform(frameState.coordinateToPixelTransform, bottomRight);\n    applyTransform(frameState.coordinateToPixelTransform, bottomLeft);\n\n    const inverted = this.inversePixelTransform;\n    applyTransform(inverted, topLeft);\n    applyTransform(inverted, topRight);\n    applyTransform(inverted, bottomRight);\n    applyTransform(inverted, bottomLeft);\n\n    context.save();\n    context.beginPath();\n    context.moveTo(Math.round(topLeft[0]), Math.round(topLeft[1]));\n    context.lineTo(Math.round(topRight[0]), Math.round(topRight[1]));\n    context.lineTo(Math.round(bottomRight[0]), Math.round(bottomRight[1]));\n    context.lineTo(Math.round(bottomLeft[0]), Math.round(bottomLeft[1]));\n    context.clip();\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @protected\n   */\n  prepareContainer(frameState, target) {\n    const extent = frameState.extent;\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    const pixelRatio = frameState.pixelRatio;\n    const width = Math.round((getWidth(extent) / resolution) * pixelRatio);\n    const height = Math.round((getHeight(extent) / resolution) * pixelRatio);\n    // set forward and inverse pixel transforms\n    composeTransform(\n      this.pixelTransform,\n      frameState.size[0] / 2,\n      frameState.size[1] / 2,\n      1 / pixelRatio,\n      1 / pixelRatio,\n      rotation,\n      -width / 2,\n      -height / 2,\n    );\n    makeInverse(this.inversePixelTransform, this.pixelTransform);\n\n    const canvasTransform = toTransformString(this.pixelTransform);\n    this.useContainer(target, canvasTransform, this.getBackground(frameState));\n\n    if (!this.containerReused) {\n      const canvas = this.context.canvas;\n      if (canvas.width != width || canvas.height != height) {\n        canvas.width = width;\n        canvas.height = height;\n      } else {\n        this.context.clearRect(0, 0, width, height);\n      }\n      if (canvasTransform !== canvas.style.transform) {\n        canvas.style.transform = canvasTransform;\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../../render/EventType.js\").default} type Event type.\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  dispatchRenderEvent_(type, context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(type)) {\n      const event = new RenderEvent(\n        type,\n        this.inversePixelTransform,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  preRender(context, frameState) {\n    this.frameState = frameState;\n    if (frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  postRender(context, frameState) {\n    if (frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeferredInternal(frameState) {}\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {import('../../render/canvas/ZIndexContext.js').ZIndexContextProxy} Context.\n   */\n  getRenderContext(frameState) {\n    if (frameState.declutter && !this.deferredContext_) {\n      this.deferredContext_ = new ZIndexContext();\n    }\n    return frameState.declutter\n      ? this.deferredContext_.getContext()\n      : this.context;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  renderDeferred(frameState) {\n    if (!frameState.declutter) {\n      return;\n    }\n    this.dispatchRenderEvent_(\n      RenderEventType.PRERENDER,\n      this.context,\n      frameState,\n    );\n    if (frameState.declutter && this.deferredContext_) {\n      this.deferredContext_.draw(this.context);\n      this.deferredContext_.clear();\n    }\n    this.renderDeferredInternal(frameState);\n    this.dispatchRenderEvent_(\n      RenderEventType.POSTRENDER,\n      this.context,\n      frameState,\n    );\n  }\n\n  /**\n   * Creates a transform for rendering to an element that will be rotated after rendering.\n   * @param {import(\"../../coordinate.js\").Coordinate} center Center.\n   * @param {number} resolution Resolution.\n   * @param {number} rotation Rotation.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {number} width Width of the rendered element (in pixels).\n   * @param {number} height Height of the rendered element (in pixels).\n   * @param {number} offsetX Offset on the x-axis in view coordinates.\n   * @protected\n   * @return {!import(\"../../transform.js\").Transform} Transform.\n   */\n  getRenderTransform(\n    center,\n    resolution,\n    rotation,\n    pixelRatio,\n    width,\n    height,\n    offsetX,\n  ) {\n    const dx1 = width / 2;\n    const dy1 = height / 2;\n    const sx = pixelRatio / resolution;\n    const sy = -sx;\n    const dx2 = -center[0] + offsetX;\n    const dy2 = -center[1];\n    return composeTransform(\n      this.tempTransform,\n      dx1,\n      dy1,\n      sx,\n      sy,\n      -rotation,\n      dx2,\n      dy2,\n    );\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    delete this.frameState;\n    super.disposeInternal();\n  }\n}\n\nexport default CanvasLayerRenderer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}